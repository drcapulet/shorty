<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: common_steps.rb</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>common_steps.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>features/step_definitions/common_steps.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Wed Jul 15 23:19:10 -0700 2009</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Given /^this project is active project folder/ do
</p>
<pre>
  @active_project_folder = File.expand_path(File.dirname(__FILE__) + &quot;/../..&quot;)
</pre>
<p>
end
</p>
<p>
Given /^env variable \$([\w_]+) set to &quot;(.*)&quot;/ do |env_var,
value|
</p>
<pre>
  ENV[env_var] = value
</pre>
<p>
end
</p>
<p>
Given /&quot;(.*)&quot; folder is deleted/ do |folder|
</p>
<pre>
  in_project_folder { FileUtils.rm_rf folder }
</pre>
<p>
end
</p>
<p>
When /^I invoke &quot;(.*)&quot; generator with arguments
&quot;(.*)&quot;$/ do |generator, arguments|
</p>
<pre>
  @stdout = StringIO.new
  in_project_folder do
    if Object.const_defined?(&quot;APP_ROOT&quot;)
      APP_ROOT.replace(FileUtils.pwd)
    else
      APP_ROOT = FileUtils.pwd
    end
    run_generator(generator, arguments.split(' '), SOURCES, :stdout =&gt; @stdout)
  end
  File.open(File.join(@tmp_root, &quot;generator.out&quot;), &quot;w&quot;) do |f|
    @stdout.rewind
    f &lt;&lt; @stdout.read
  end
</pre>
<p>
end
</p>
<p>
When /^I run executable &quot;(.*)&quot; with arguments &quot;(.*)&quot;/
do |executable, arguments|
</p>
<pre>
  @stdout = File.expand_path(File.join(@tmp_root, &quot;executable.out&quot;))
  in_project_folder do
    system &quot;#{executable} #{arguments} &gt; #{@stdout} 2&gt; #{@stdout}&quot;
  end
</pre>
<p>
end
</p>
<p>
When /^I run project executable &quot;(.*)&quot; with arguments
&quot;(.*)&quot;/ do |executable, arguments|
</p>
<pre>
  @stdout = File.expand_path(File.join(@tmp_root, &quot;executable.out&quot;))
  in_project_folder do
    system &quot;ruby #{executable} #{arguments} &gt; #{@stdout} 2&gt; #{@stdout}&quot;
  end
</pre>
<p>
end
</p>
<p>
When /^I run local executable &quot;(.*)&quot; with arguments
&quot;(.*)&quot;/ do |executable, arguments|
</p>
<pre>
  @stdout = File.expand_path(File.join(@tmp_root, &quot;executable.out&quot;))
  executable = File.expand_path(File.join(File.dirname(__FILE__), &quot;/../../bin&quot;, executable))
  in_project_folder do
    system &quot;ruby #{executable} #{arguments} &gt; #{@stdout} 2&gt; #{@stdout}&quot;
  end
</pre>
<p>
end
</p>
<p>
When /^I invoke task &quot;rake (.*)&quot;/ do |task|
</p>
<pre>
  @stdout = File.expand_path(File.join(@tmp_root, &quot;tests.out&quot;))
  in_project_folder do
    system &quot;rake #{task} --trace &gt; #{@stdout} 2&gt; #{@stdout}&quot;
  end
</pre>
<p>
end
</p>
<p>
Then /^folder &quot;(.*)&quot; (is|is not) created/ do |folder, is|
</p>
<pre>
  in_project_folder do
    File.exists?(folder).should(is == 'is' ? be_true : be_false)
  end
</pre>
<p>
end
</p>
<p>
Then /^file &quot;(.*)&quot; (is|is not) created/ do |file, is|
</p>
<pre>
  in_project_folder do
    File.exists?(file).should(is == 'is' ? be_true : be_false)
  end
</pre>
<p>
end
</p>
<p>
Then /^file with name matching &quot;(.*)&quot; is created/ do |pattern|
</p>
<pre>
  in_project_folder do
    Dir[pattern].should_not be_empty
  end
</pre>
<p>
end
</p>
<p>
Then /^file &quot;(.*)&quot; contents (does|does not) match \/(.*)\// do
|file, does, regex|
</p>
<pre>
  in_project_folder do
    actual_output = File.read(file)
    (does == 'does') ?
      actual_output.should(match(/#{regex}/)) :
      actual_output.should_not(match(/#{regex}/))
  end
</pre>
<p>
end
</p>
<p>
Then /gem file &quot;(.*)&quot; and generated file &quot;(.*)&quot; should
be the same/ do |gem_file, project_file|
</p>
<pre>
  File.exists?(gem_file).should be_true
  File.exists?(project_file).should be_true
  gem_file_contents = File.read(File.dirname(__FILE__) + &quot;/../../#{gem_file}&quot;)
  project_file_contents = File.read(File.join(@active_project_folder, project_file))
  project_file_contents.should == gem_file_contents
</pre>
<p>
end
</p>
<p>
Then /^(does|does not) invoke generator &quot;(.*)&quot;$/ do |does_invoke,
generator|
</p>
<pre>
  actual_output = File.read(@stdout)
  does_invoke == &quot;does&quot; ?
    actual_output.should(match(/dependency\s+#{generator}/)) :
    actual_output.should_not(match(/dependency\s+#{generator}/))
</pre>
<p>
end
</p>
<p>
Then /help options &quot;(.*)&quot; and &quot;(.*)&quot; are displayed/ do
|opt1, opt2|
</p>
<pre>
  actual_output = File.read(@stdout)
  actual_output.should match(/#{opt1}/)
  actual_output.should match(/#{opt2}/)
</pre>
<p>
end
</p>
<p>
Then /^I should see$/ do |text|
</p>
<pre>
  actual_output = File.read(@stdout)
  actual_output.should contain(text)
</pre>
<p>
end
</p>
<p>
Then /^I should not see$/ do |text|
</p>
<pre>
  actual_output = File.read(@stdout)
  actual_output.should_not contain(text)
</pre>
<p>
end
</p>
<p>
Then /^I should see exactly$/ do |text|
</p>
<pre>
  actual_output = File.read(@stdout)
  actual_output.should == text
</pre>
<p>
end
</p>
<p>
Then /^I should see all (\d+) tests pass/ do |expected_test_count|
</p>
<pre>
  expected = %r{^#{expected_test_count} tests, \d+ assertions, 0 failures, 0 errors}
  actual_output = File.read(@stdout)
  actual_output.should match(expected)
</pre>
<p>
end
</p>
<p>
Then /^I should see all (\d+) examples pass/ do |expected_test_count|
</p>
<pre>
  expected = %r{^#{expected_test_count} examples?, 0 failures}
  actual_output = File.read(@stdout)
  actual_output.should match(expected)
</pre>
<p>
end
</p>
<p>
Then /^yaml file &quot;(.*)&quot; contains (\{.*\})/ do |file, yaml|
</p>
<pre>
  in_project_folder do
    yaml = eval yaml
    YAML.load(File.read(file)).should == yaml
  end
</pre>
<p>
end
</p>
<p>
Then /^Rakefile can display tasks successfully/ do
</p>
<pre>
  @stdout = File.expand_path(File.join(@tmp_root, &quot;rakefile.out&quot;))
  in_project_folder do
    system &quot;rake -T &gt; #{@stdout} 2&gt; #{@stdout}&quot;
  end
  actual_output = File.read(@stdout)
  actual_output.should match(/^rake\s+\w+\s+#\s.*/)
</pre>
<p>
end
</p>
<p>
Then /^task &quot;rake (.*)&quot; is executed successfully/ do |task|
</p>
<pre>
  @stdout.should_not be_nil
  actual_output = File.read(@stdout)
  actual_output.should_not match(/^Don't know how to build task '#{task}'/)
  actual_output.should_not match(/Error/i)
</pre>
<p>
end
</p>
<p>
Then /^gem spec key &quot;(.*)&quot; contains \/(.*)\// do |key, regex|
</p>
<pre>
  in_project_folder do
    gem_file = Dir[&quot;pkg/*.gem&quot;].first
    gem_spec = Gem::Specification.from_yaml(`gem spec #{gem_file}`)
    spec_value = gem_spec.send(key.to_sym)
    spec_value.to_s.should match(/#{regex}/)
  end
</pre>
<p>
end
</p>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>